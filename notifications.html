<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏ï‡πâ‡∏≠‡∏´‡∏¥‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS styles */
        :root {
            --primary: #00A8A8;
            --primary-dark: #007878;
            --primary-light: #E0F2F1;
            --secondary: #00CECE;
            --dark: #324047;
            --gray: #6B7280;
            --light-gray: #F3F4F6;
            --white: #FFFFFF;
            --error: #EF4444;
            --success: #10B981;
            --warning: #F59E0B;
            --info: #3B82F6;
            --border: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans Thai', sans-serif;
            background-color: #F9FAFB;
            color: var(--dark);
            min-height: 100vh;
        }

        /* Layout */
        .layout {
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--white);
            height: 100vh;
            position: fixed;
            box-shadow: var(--shadow);
            z-index: 10;
            transition: all 0.3s ease;
        }

        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 20;
            background: var(--primary);
            color: var(--white);
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .logo-container {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            width: 50px;
            height: 50px;
            background-color: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 24px;
            font-weight: bold;
            margin-right: 12px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .logo-subtitle {
            font-size: 12px;
            color: var(--gray);
        }

        .menu {
            padding: 20px 0;
            overflow-y: auto;
            max-height: calc(100vh - 91px);
        }

        .menu-label {
            padding: 0 20px;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--gray);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .menu-item.active {
            background-color: var(--primary-light);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        /* Header */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notifications-btn {
            background: var(--white);
            border: 1px solid var(--border);
            color: var(--gray);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .notifications-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
            background-color: var(--error);
            border-radius: 50%;
            border: 2px solid var(--white);
            display: none;
        }

        .user-dropdown {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 6px 8px 6px 6px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background-color: var(--primary-light);
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            margin-right: 8px;
        }

        /* User Menu */
        .user-menu {
            position: absolute;
            right: 0;
            top: 50px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            width: 200px;
            z-index: 100;
            display: none;
        }

        .user-menu.show {
            display: block;
        }

        .user-menu-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border);
        }

        .user-menu-item:last-child {
            border-bottom: none;
        }

        .user-menu-item:hover {
            background-color: var(--light-gray);
        }

        .user-menu-logout {
            color: var(--error);
        }

        /* Card Styles */
        .card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .card-action {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
        }

        .card-body {
            padding: 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Notification Styles */
        .notification-item {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 20px;
        }

        .notification-icon.medication_reminder {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .notification-icon.appointment_reminder {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .notification-icon.health_alert {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .notification-icon.medication_inventory {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .notification-icon.emergency_alert {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .notification-icon.system {
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--gray);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--gray);
        }

        .notification-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 8px;
        }

        .notification-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .notification-btn.primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .notification-btn.primary:hover {
            background-color: var(--primary-dark);
        }

        .notification-btn.secondary {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .notification-btn.secondary:hover {
            background-color: var(--border);
        }

        .notification-unread {
            position: relative;
        }

        .notification-unread::before {
            content: '';
            position: absolute;
            top: 16px;
            right: 16px;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            border-radius: 50%;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -8px;
        }

        .form-col {
            flex: 1;
            min-width: 250px;
            padding: 0 8px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 168, 168, 0.1);
        }

        .form-help {
            font-size: 13px;
            color: var(--gray);
            margin-top: 4px;
        }

        .form-switch {
            display: flex;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray);
            transition: .3s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Medication Reminder Styles */
        .medication-item {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .medication-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .medication-schedule {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .medication-time {
            font-size: 13px;
            color: var(--gray);
        }

        .medication-actions {
            display: flex;
            gap: 8px;
        }

        .medication-action-btn {
            padding: 6px 12px;
            background-color: var(--primary-light);
            color: var(--primary);
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .medication-action-btn:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .reminder-days {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .day-box {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .day-box.selected {
            background-color: var(--primary);
            color: var(--white);
        }

        .day-box.unselected {
            background-color: var(--light-gray);
            color: var(--gray);
        }

        .reminder-times {
            margin-top: 12px;
        }

        .time-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .time-input {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .time-label {
            font-size: 14px;
            flex: 1;
        }

        .time-remove {
            color: var(--error);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        .add-time-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding: 8px 12px;
            background-color: var(--primary-light);
            color: var(--primary);
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .add-time-btn:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 15px;
            margin-bottom: 16px;
        }

        /* API Error */
        .api-error {
            background-color: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            display: none;
        }

        .api-error-icon {
            width: 40px;
            height: 40px;
            background-color: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--error);
            flex-shrink: 0;
        }

        .api-error-content {
            flex: 1;
        }

        .api-error-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .api-error-message {
            font-size: 14px;
            color: var(--gray);
        }

        .api-error-retry {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background-color: var(--error);
            color: var(--white);
            transition: all 0.3s ease;
        }

        .api-error-retry:hover {
            background-color: #dc2626;
        }

        /* Loading Spinner */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 168, 168, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 16px;
        }

        .loading-text {
            font-size: 15px;
            color: var(--gray);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .modal {
            width: 100%;
            max-width: 700px;
            background-color: var(--white);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-height: 90vh;
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 18px;
            color: var(--gray);
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: var(--gray);
            color: var(--white);
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .modal-btn.secondary {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .modal-btn.danger {
            background-color: var(--error);
            color: var(--white);
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ */
        .medication-info-box {
            background-color: #F0F9FF;
            border: 1px solid #0EA5E9;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .medication-info-title {
            color: #0EA5E9;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .medication-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 14px;
        }

        .usage-guidelines-box {
            background-color: #F0FDF4;
            border: 1px solid #10B981;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .usage-guidelines-title {
            color: #10B981;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .suggested-times-box {
            background-color: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 8px;
            padding: 16px;
        }

        .suggested-time-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background-color: white;
            border-radius: 6px;
        }

        .suggested-time {
            width: 80px;
            font-weight: 500;
        }

        .suggested-label {
            flex: 1;
            margin-left: 12px;
        }

        .suggested-badge {
            font-size: 12px;
            color: #6B7280;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .main-content {
                margin-left: 0;
                padding-top: 60px;
            }
        }

        @media (max-width: 768px) {
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 8px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-col {
                width: 100%;
            }
            
            .notification-item {
                flex-direction: column;
            }
            
            .notification-icon {
                margin-bottom: 8px;
            }

            .medication-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo-container">
                <div class="logo">G</div>
                <div class="logo-text">
                    <div class="logo-title">GTMS</div>
                    <div class="logo-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏ï‡πâ‡∏≠‡∏´‡∏¥‡∏ô</div>
                </div>
            </div>
            
            <nav class="menu">
                <p class="menu-label">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</p>
                <a href="dashboard.html" class="menu-item">
                    <div class="menu-icon">üìä</div>
                    ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </a>
                <a href="appointments.html" class="menu-item">
                    <div class="menu-icon">üìÖ</div>
                    ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
                </a>
                
                <p class="menu-label">‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</p>
                <a href="iop-tracking.html" class="menu-item">
                    <div class="menu-icon">üëÅÔ∏è</div>
                    ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏•‡∏π‡∏Å‡∏ï‡∏≤
                </a>
                <a href="medications.html" class="menu-item">
                    <div class="menu-icon">üíä</div>
                    ‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
                </a>
                <a href="eye-tests.html" class="menu-item">
                    <div class="menu-icon">üìù</div>
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î
                </a>
                
                <p class="menu-label">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
                <a href="profile.html" class="menu-item">
                    <div class="menu-icon">üë§</div>
                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
                </a>
                <a href="notifications.html" class="menu-item active">
                    <div class="menu-icon">üîî</div>
                    ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </a>
                <a href="documents.html" class="menu-item">
                    <div class="menu-icon">üìÑ</div>
                    ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
                </a>
                <a href="settings.html" class="menu-item">
                    <div class="menu-icon">‚öôÔ∏è</div>
                    ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </a>
                <a href="#" class="menu-item" onclick="logout()">
                    <div class="menu-icon">üö™</div>
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- API Error Display -->
            <div class="api-error" id="apiError">
                <div class="api-error-icon">‚ö†Ô∏è</div>
                <div class="api-error-content">
                    <div class="api-error-title">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>
                    <div class="api-error-message" id="apiErrorMessage">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                </div>
                <button class="api-error-retry" onclick="loadData()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
            </div>

            <div class="content-header">
                <h1 class="page-title">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
                
                <div class="user-info">
                    <button class="notifications-btn" onclick="location.href='notifications.html'">
                        üîî
                        <span class="notifications-indicator" id="notificationsIndicator"></span>
                    </button>
                    
                    <div class="user-dropdown" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="headerUserAvatar">-</div>
                        <span class="user-name" id="headerUserName">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                        <span>‚ñº</span>
                    </div>

                    <!-- User Menu Dropdown -->
                    <div class="user-menu" id="userMenu">
                        <a href="profile.html" class="user-menu-item">
                            <div class="menu-icon">üë§</div>
                            ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                        </a>
                        <a href="settings.html" class="user-menu-item">
                            <div class="menu-icon">‚öôÔ∏è</div>
                            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </a>
                        <a href="#" class="user-menu-item user-menu-logout" onclick="logout()">
                            <div class="menu-icon">üö™</div>
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </a>
                    </div>
                </div>
            </div>

            <!-- Notifications Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="notifications" onclick="switchTab('notifications')">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="tab" data-tab="medication-reminders" onclick="switchTab('medication-reminders')">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</div>
                <div class="tab" data-tab="settings" onclick="switchTab('settings')">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
            </div>

            <!-- All Notifications Tab -->
            <div id="notifications-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <span class="card-action" onclick="markAllAsRead()">‚úì ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="card-body">
                        <!-- Loading Spinner -->
                        <div class="loading-container" id="notifications-loading">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                        </div>
                        
                        <div id="notifications-container" style="display: none;">
                            <!-- Notifications will be loaded here -->
                        </div>
                        
                        <!-- Empty State -->
                        <div class="empty-state" id="notifications-empty" style="display: none;">
                            <div class="empty-state-icon">üîî</div>
                            <div class="empty-state-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medication Reminders Tab -->
            <div id="medication-reminders-tab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</h2>
                        <span class="card-action" onclick="showAddMedicationReminderModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</span>
                    </div>
                    <div class="card-body">
                        <!-- Loading Spinner -->
                        <div class="loading-container" id="reminders-loading">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                        </div>
                        
                        <div id="reminders-container" style="display: none;">
                            <!-- Medication reminders will be loaded here -->
                        </div>
                        
                        <!-- Empty State -->
                        <div class="empty-state" id="reminders-empty" style="display: none;">
                            <div class="empty-state-icon">üíä</div>
                            <div class="empty-state-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</div>
                            <button class="modal-btn primary" onclick="showAddMedicationReminderModal()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Settings Tab -->
            <div id="settings-tab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <h3 style="margin-bottom: 16px;">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</h3>
                            
                            <div class="form-switch">
                                <label class="switch">
                                    <input type="checkbox" id="medication-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <label for="medication-notifications">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="medication-settings">
                            <div class="form-row">
                                <div class="form-col">
                                    <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</label>
                                    <select class="form-select" id="medication-reminder-time">
                                        <option value="0">‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤</option>
                                        <option value="5">5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</option>
                                        <option value="10">10 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</option>
                                        <option value="15" selected>15 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</option>
                                        <option value="30">30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</option>
                                        <option value="60">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label class="form-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ã‡πâ‡∏≥</label>
                                    <select class="form-select" id="medication-reminder-repeat">
                                        <option value="0">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ã‡πâ‡∏≥</option>
                                        <option value="5" selected>‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                        <option value="10">‡∏ó‡∏∏‡∏Å 10 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                        <option value="15">‡∏ó‡∏∏‡∏Å 15 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                        <option value="30">‡∏ó‡∏∏‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label class="form-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ã‡πâ‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                                    <select class="form-select" id="medication-reminder-max-repeat">
                                        <option value="1">1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                                        <option value="2">2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                                        <option value="3" selected>3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                                        <option value="4">4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                                        <option value="5">5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label class="form-label">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                                    <select class="form-select" id="medication-reminder-sound">
                                        <option value="default" selected>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                                        <option value="bell">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á</option>
                                        <option value="chime">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏Ü‡∏±‡∏á</option>
                                        <option value="alert">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                                        <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--border);">
                        
                        <div class="form-group">
                            <h3 style="margin-bottom: 16px;">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</h3>
                            
                            <div class="form-switch">
                                <label class="switch">
                                    <input type="checkbox" id="appointment-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <label for="appointment-notifications">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="appointment-settings">
                            <div class="form-row">
                                <div class="form-col">
                                    <label class="form-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</label>
                                    <select class="form-select" id="appointment-reminder-time">
                                        <option value="1">1 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</option>
                                        <option value="2">2 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</option>
                                        <option value="3" selected>3 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</option>
                                        <option value="5">5 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</option>
                                        <option value="7">7 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                                    <input type="time" class="form-input" id="appointment-reminder-hour" value="09:00">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label class="form-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</label>
                                    <div class="form-switch">
                                        <label class="switch">
                                            <input type="checkbox" id="appointment-reminder-day-of" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <label for="appointment-reminder-day-of">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</label>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label class="form-label">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                                    <select class="form-select" id="appointment-reminder-sound">
                                        <option value="default" selected>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                                        <option value="bell">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á</option>
                                        <option value="chime">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏Ü‡∏±‡∏á</option>
                                        <option value="alert">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                                        <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--border);">
                        
                        <div class="form-group">
                            <h3 style="margin-bottom: 16px;">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h3>
                            
                            <div class="form-switch" style="margin-bottom: 12px;">
                                <label class="switch">
                                    <input type="checkbox" id="iop-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <label for="iop-notifications">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</label>
                            </div>
                            
                            <div class="form-switch" style="margin-bottom: 12px;">
                                <label class="switch">
                                    <input type="checkbox" id="medication-inventory-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <label for="medication-inventory-notifications">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</label>
                            </div>
                            
                            <div class="form-switch" style="margin-bottom: 12px;">
                                <label class="switch">
                                    <input type="checkbox" id="result-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <label for="result-notifications">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà</label>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 24px;">
                            <button class="modal-btn primary" onclick="saveNotificationSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Medication Reminder Modal -->
    <div class="modal-backdrop" id="addMedicationReminderModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</h2>
                <button class="modal-close" onclick="closeModal('addMedicationReminderModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addMedicationReminderForm">
                    <div class="form-group">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
                        <select class="form-select" id="medication-name" required onchange="onMedicationSelected()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤</option>
                            <!-- ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API -->
                        </select>
                        <div class="form-help">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                    </div>

                    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
                    <div id="medication-info" style="display: none;">
                        <div class="medication-info-box">
                            <h4 class="medication-info-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h4>
                            <div id="medication-details" class="medication-details"></div>
                        </div>
                        
                        <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤ -->
                        <div id="usage-guidelines" class="usage-guidelines-box" style="display: none;">
                            <h4 class="usage-guidelines-title">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤</h4>
                            <ul id="guidelines-list"></ul>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</label>
                        <select class="form-select" id="medication-schedule" required disabled onchange="onScheduleSelected()">
                            <option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏Å‡πà‡∏≠‡∏ô</option>
                            <option value="suggested">‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</option>
                            <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á</option>
                        </select>
                        <div class="form-help">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤</div>
                    </div>

                    <div class="form-group" id="suggested-times-group" style="display: none;">
                        <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</label>
                        <div id="suggested-times-list" class="suggested-times-box">
                            <!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                        </div>
                        <div class="form-help">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏≠‡∏™‡∏±‡πà‡∏á</div>
                    </div>
                    
                    <div class="form-group" id="custom-times-group" style="display: none;">
                        <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á)</label>
                        <div class="reminder-times" id="reminder-times">
                            <div class="time-item">
                                <input type="time" class="time-input" required>
                                <span class="time-label">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</span>
                                <button type="button" class="time-remove" onclick="removeTimeInput(this)">√ó</button>
                            </div>
                        </div>
                        <button type="button" class="add-time-btn" onclick="addTimeInput()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                        <input type="text" class="form-input" id="medication-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏ó‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeModal('addMedicationReminderModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="modal-btn primary" id="saveMedicationReminderBtn" onclick="addMedicationReminder()">
                    <span id="saveMedicationReminderSpinner" class="loading-spinner" style="display: none;"></span>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Medication Reminder Modal -->
    <div class="modal-backdrop" id="editMedicationReminderModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</h2>
                <button class="modal-close" onclick="closeModal('editMedicationReminderModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editMedicationReminderForm">
                    <input type="hidden" id="edit-reminder-id">
                    
                    <div class="form-group">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
                        <select class="form-select" id="edit-medication-name" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤</option>
                            <!-- ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</label>
                        <div class="reminder-times" id="edit-reminder-times">
                            <!-- ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å JavaScript -->
                        </div>
                        <button type="button" class="add-time-btn" onclick="addEditTimeInput()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                        <input type="text" class="form-input" id="edit-medication-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏ó‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" onclick="deleteMedicationReminder()">‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
                <button class="modal-btn secondary" onclick="closeModal('editMedicationReminderModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="modal-btn primary" id="editMedicationReminderBtn" onclick="updateMedicationReminder()">
                    <span id="editMedicationReminderSpinner" class="loading-spinner" style="display: none;"></span>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Configuration - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Backend API
        const API_BASE_URL = 'http://localhost:5001/api';
        let patientId = '';
        let userData = null;
        let notifications = [];
        let medicationReminders = [];
        let medications = [];
        let currentTab = 'notifications';
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        function checkAuth() {
            const token = localStorage.getItem('gtms_token');
            
            if (!token) {
                window.location.href = 'index.html';
                return false;
            }
            
            return token;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        async function loadUserProfile() {
            const token = checkAuth();
            if (!token) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load user profile');
                }
                
                const data = await response.json();
                userData = data.user;
                patientId = userData.id;
                
                // Debug: ‡πÅ‡∏™‡∏î‡∏á user ID ‡πÉ‡∏ô console
                console.log('Loaded user data:', userData);
                console.log('Patient ID:', patientId);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                updateUserUI();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á
                loadData();
                
            } catch (error) {
                console.error('Error loading profile:', error);
                showApiError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ');
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        function updateUserUI() {
            if (!userData) return;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß
            const headerUserName = document.getElementById('headerUserName');
            const headerUserAvatar = document.getElementById('headerUserAvatar');
            
            if (userData.firstName && userData.lastName) {
                headerUserName.textContent = `${userData.firstName} ${userData.lastName}`;
                headerUserAvatar.textContent = userData.firstName.charAt(0);
            } else if (userData.username) {
                headerUserName.textContent = userData.username;
                headerUserAvatar.textContent = userData.username.charAt(0).toUpperCase();
            }
        }

        // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ó‡πá‡∏ö
        function switchTab(tab) {
            // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.getElementById(`${tab}-tab`).style.display = 'block';
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.querySelectorAll('.tab').forEach(tabEl => {
                tabEl.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            currentTab = tab;
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            loadData();
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á
        function loadData() {
            if (!patientId) return;
            
            switch (currentTab) {
                case 'notifications':
                    loadNotifications();
                    break;
                case 'medication-reminders':
                    loadMedicationReminders();
                    loadMedications();
                    break;
                case 'settings':
                    loadNotificationSettings();
                    break;
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - ‡πÄ‡∏û‡∏¥‡πà‡∏° debug ‡πÅ‡∏•‡∏∞ fallback
        async function loadNotifications() {
            const token = checkAuth();
            if (!token) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á Loading
            document.getElementById('notifications-loading').style.display = 'flex';
            document.getElementById('notifications-container').style.display = 'none';
            document.getElementById('notifications-empty').style.display = 'none';
            hideApiError();
            
            try {
                console.log('=== FRONTEND DEBUG ===');
                console.log('API URL:', `${API_BASE_URL}/patient/notifications?limit=50`);
                console.log('Token:', token.substring(0, 20) + '...');
                console.log('Patient ID:', patientId);
                
                // ‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å test endpoint ‡∏Å‡πà‡∏≠‡∏ô
                console.log('Testing with test endpoint...');
                const testResponse = await fetch(`${API_BASE_URL}/test/notifications`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (testResponse.ok) {
                    const testData = await testResponse.json();
                    console.log('Test endpoint success:', testData);
                } else {
                    const testError = await testResponse.text();
                    console.log('Test endpoint failed:', testError);
                }
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏´‡∏•‡∏±‡∏Å
                const response = await fetch(`${API_BASE_URL}/patient/notifications?limit=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { message: errorText };
                    }
                    
                    throw new Error(`Failed to load notifications: ${response.status} ${response.statusText}\nDetails: ${JSON.stringify(errorData)}`);
                }
                
                const data = await response.json();
                console.log('Received data:', data);
                
                notifications = data.notifications || [];
                console.log('Notifications array:', notifications);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
                updateUnreadNotificationCount();
                
                // ‡∏ã‡πà‡∏≠‡∏ô Loading
                document.getElementById('notifications-loading').style.display = 'none';
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                renderNotifications();
                
            } catch (error) {
                console.error('Error loading notifications:', error);
                document.getElementById('notifications-loading').style.display = 'none';
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
                if (error.message.includes('500')) {
                    showApiError('‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Backend logs');
                } else if (error.message.includes('Failed to fetch')) {
                    showApiError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Backend Server');
                } else {
                    showApiError(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ: ${error.message}`);
                }
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function renderNotifications() {
            const container = document.getElementById('notifications-container');
            
            if (!notifications || notifications.length === 0) {
                document.getElementById('notifications-empty').style.display = 'block';
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            container.innerHTML = '';
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô
            notifications.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'notification-item';
                
                if (!notification.is_read) {
                    notificationItem.classList.add('notification-unread');
                }
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                let iconClass = 'system';
                let iconText = 'üì¢';
                
                if (notification.notification_type) {
                    switch (notification.notification_type) {
                        case 'medication_reminder':
                            iconClass = 'medication_reminder';
                            iconText = 'üíä';
                            break;
                        case 'appointment_reminder':
                            iconClass = 'appointment_reminder';
                            iconText = 'üìÖ';
                            break;
                        case 'health_alert':
                            iconClass = 'health_alert';
                            iconText = '‚ö†Ô∏è';
                            break;
                        case 'medication_inventory':
                            iconClass = 'medication_inventory';
                            iconText = 'üì¶';
                            break;
                        case 'emergency_alert':
                            iconClass = 'emergency_alert';
                            iconText = 'üö®';
                            break;
                        default:
                            iconClass = 'system';
                            iconText = 'üì¢';
                    }
                }
                
                notificationItem.innerHTML = `
                    <div class="notification-icon ${iconClass}">
                        ${iconText}
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.body}</div>
                        <div class="notification-time">${formatTimeAgo(new Date(notification.created_at))}</div>
                        ${!notification.is_read ? `
                        <div class="notification-actions">
                            <button class="notification-btn secondary" onclick="markAsRead('${notification.notification_id}')">
                                ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                container.appendChild(notificationItem);
            });
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
        function updateUnreadNotificationCount() {
            if (!notifications) return;
            
            const unreadCount = notifications.filter(n => !n.is_read).length;
            const indicator = document.getElementById('notificationsIndicator');
            
            if (unreadCount > 0) {
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        // ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
        async function markAsRead(notificationId) {
            const token = checkAuth();
            if (!token) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/patient/notifications/${notificationId}/read`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to mark notification as read');
                }
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                const notification = notifications.find(n => n.notification_id === notificationId);
                if (notification) {
                    notification.is_read = true;
                    renderNotifications();
                    updateUnreadNotificationCount();
                }
                
            } catch (error) {
                console.error('Error marking notification as read:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function markAllAsRead() {
            const token = checkAuth();
            if (!token) return;
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
            const unreadNotifications = notifications.filter(n => !n.is_read);
            
            if (unreadNotifications.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/patient/notifications/mark-all-read`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to mark all notifications as read');
                }
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                notifications.forEach(notification => {
                    notification.is_read = true;
                });
                
                renderNotifications();
                updateUnreadNotificationCount();
                
                alert('‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');
                
            } catch (error) {
                console.error('Error marking all notifications as read:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ (‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
        async function loadMedicationReminders() {
            const token = checkAuth();
            if (!token) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á Loading
            document.getElementById('reminders-loading').style.display = 'flex';
            document.getElementById('reminders-container').style.display = 'none';
            document.getElementById('reminders-empty').style.display = 'none';
            hideApiError();
            
            try {
                // ‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô
                const response = await fetch(`${API_BASE_URL}/patient/medication-reminders`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load medication reminders');
                }
                
                const data = await response.json();
                const originalReminders = data.reminders || [];
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö format ‡πÉ‡∏´‡∏°‡πà
                medicationReminders = [];
                const groupedByMedication = {};
                
                originalReminders.forEach(reminder => {
                    const medId = reminder.medication_id;
                    if (!groupedByMedication[medId]) {
                        groupedByMedication[medId] = {
                            medication_id: medId,
                            medication_name: reminder.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤',
                            eye_display: reminder.eye_display || '‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤',
                            frequency: '‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                            reminders: []
                        };
                    }
                    
                    groupedByMedication[medId].reminders.push({
                        reminder_id: reminder.reminder_id,
                        reminder_time: reminder.reminder_time,
                        taken_today: 0,
                        missed_today: 0
                    });
                });
                
                medicationReminders = Object.values(groupedByMedication);
                
                // ‡∏ã‡πà‡∏≠‡∏ô Loading
                document.getElementById('reminders-loading').style.display = 'none';
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
                renderMedicationReminders();
                
            } catch (error) {
                console.error('Error loading medication reminders:', error);
                document.getElementById('reminders-loading').style.display = 'none';
                showApiError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÑ‡∏î‡πâ');
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
        async function loadMedications() {
            const token = checkAuth();
            if (!token) return;
            
            try {
                // ‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ backend ‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°
                const response = await fetch(`${API_BASE_URL}/patient/medications`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load medications');
                }
                
                const data = await response.json();
                const originalMedications = data.medications || [];
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö format ‡πÉ‡∏´‡∏°‡πà
                medications = originalMedications.map(med => ({
                    prescription_id: med.prescription_id,
                    medication_id: med.medication_id,
                    name: med.name,
                    eye: med.eye || 'both',
                    eye_display: med.eye === 'left' ? '‡∏ï‡∏≤‡∏ã‡πâ‡∏≤‡∏¢' : med.eye === 'right' ? '‡∏ï‡∏≤‡∏Ç‡∏ß‡∏≤' : '‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤',
                    dosage: med.dosage,
                    frequency: med.frequency || '‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    strength: med.strength,
                    daily_frequency: 2, // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    suggested_times: ['08:00', '20:00'], // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    usage_guidelines: med.form && med.form.includes('drop') ? [
                        '‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏¢‡∏≠‡∏î‡∏¢‡∏≤',
                        '‡∏î‡∏∂‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢',
                        '‡∏´‡∏¢‡∏≠‡∏î‡∏¢‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ñ‡∏∏‡∏á‡πÉ‡∏ï‡πâ‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏≤‡∏•‡πà‡∏≤‡∏á',
                        '‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1-2 ‡∏ô‡∏≤‡∏ó‡∏µ'
                    ] : ['‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á'],
                    is_eye_drop: med.form && med.form.includes('drop'),
                    reminder_status: 'not_set' // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                }));
                
                console.log('Loaded medications for reminder:', medications);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                updateMedicationOptions();
                
            } catch (error) {
                console.error('Error loading medications:', error);
                showApiError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÑ‡∏î‡πâ');
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô)
        function updateMedicationOptions() {
            const medicationSelect = document.getElementById('medication-name');
            const editMedicationSelect = document.getElementById('edit-medication-name');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°
            medicationSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤</option>';
            editMedicationSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤</option>';
            
            if (!medications || medications.length === 0) {
                medicationSelect.innerHTML += '<option value="" disabled>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</option>';
                editMedicationSelect.innerHTML += '<option value="" disabled>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</option>';
                return;
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            medications.forEach(medication => {
                const reminderStatus = medication.reminder_status === 'set' ? ' (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß)' : ' (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á)';
                const eyeInfo = medication.eye_display ? ` - ${medication.eye_display}` : '';
                const strengthInfo = medication.strength ? ` ${medication.strength}` : '';
                const frequencyInfo = medication.frequency ? ` (${medication.frequency})` : '';
                
                const optionText = `${medication.name}${strengthInfo}${eyeInfo}${frequencyInfo}${reminderStatus}`;
                
                const option1 = document.createElement('option');
                option1.value = JSON.stringify({
                    prescription_id: medication.prescription_id,
                    medication_id: medication.medication_id,
                    name: medication.name,
                    eye: medication.eye,
                    eye_display: medication.eye_display,
                    dosage: medication.dosage,
                    frequency: medication.frequency,
                    daily_frequency: medication.daily_frequency,
                    suggested_times: medication.suggested_times,
                    usage_guidelines: medication.usage_guidelines,
                    is_eye_drop: medication.is_eye_drop,
                    strength: medication.strength
                });
                option1.textContent = optionText;
                option1.style.color = medication.reminder_status === 'set' ? '#10B981' : '#374151';
                
                const option2 = document.createElement('option');
                option2.value = option1.value;
                option2.textContent = optionText;
                option2.style.color = option1.style.color;
                
                medicationSelect.appendChild(option1);
                editMedicationSelect.appendChild(option2);
            });
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤ - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        function onMedicationSelected() {
            const medicationSelect = document.getElementById('medication-name');
            const scheduleSelect = document.getElementById('medication-schedule');
            const medicationInfo = document.getElementById('medication-info');
            const usageGuidelines = document.getElementById('usage-guidelines');
            
            if (!medicationSelect.value) {
                medicationInfo.style.display = 'none';
                scheduleSelect.disabled = true;
                scheduleSelect.innerHTML = '<option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏Å‡πà‡∏≠‡∏ô</option>';
                return;
            }
            
            try {
                const medicationData = JSON.parse(medicationSelect.value);
                console.log('Selected medication:', medicationData);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤
                const detailsDiv = document.getElementById('medication-details');
                detailsDiv.innerHTML = `
                    <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤:</strong> ${medicationData.name}</div>
                    <div><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${medicationData.eye_display || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                    <div><strong>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤:</strong> ${medicationData.dosage || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                    <div><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà:</strong> ${medicationData.frequency || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                `;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤
                if (medicationData.usage_guidelines && medicationData.usage_guidelines.length > 0) {
                    const guidelinesList = document.getElementById('guidelines-list');
                    guidelinesList.innerHTML = medicationData.usage_guidelines
                        .map(guideline => `<li style="margin-bottom: 4px;">${guideline}</li>`)
                        .join('');
                    usageGuidelines.style.display = 'block';
                } else {
                    usageGuidelines.style.display = 'none';
                }
                
                medicationInfo.style.display = 'block';
                
                // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                scheduleSelect.disabled = false;
                scheduleSelect.innerHTML = `
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</option>
                    <option value="suggested">‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</option>
                    <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á</option>
                `;
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                window.selectedMedicationData = medicationData;
                
            } catch (error) {
                console.error('Error parsing medication data:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤');
            }
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function onScheduleSelected() {
            const scheduleSelect = document.getElementById('medication-schedule');
            const suggestedTimesGroup = document.getElementById('suggested-times-group');
            const customTimesGroup = document.getElementById('custom-times-group');
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°
            suggestedTimesGroup.style.display = 'none';
            customTimesGroup.style.display = 'none';
            
            if (scheduleSelect.value === 'suggested' && window.selectedMedicationData) {
                // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                showSuggestedTimes();
                suggestedTimesGroup.style.display = 'block';
            } else if (scheduleSelect.value === 'custom') {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á
                customTimesGroup.style.display = 'block';
                resetCustomTimes();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        function showSuggestedTimes() {
            if (!window.selectedMedicationData || !window.selectedMedicationData.suggested_times) {
                return;
            }
            
            const suggestedTimesList = document.getElementById('suggested-times-list');
            const suggestedTimes = window.selectedMedicationData.suggested_times;
            const dailyFrequency = window.selectedMedicationData.daily_frequency || suggestedTimes.length;
            
            const timeLabels = ['‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤', '‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á', '‡∏ï‡∏≠‡∏ô‡∏ö‡πà‡∏≤‡∏¢', '‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô', '‡∏ï‡∏≠‡∏ô‡∏Ñ‡πà‡∏≥'];
            
            let timesHtml = `
                <div style="margin-bottom: 12px;">
                    <strong>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤ ${dailyFrequency} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong>
                </div>
            `;
            
            suggestedTimes.forEach((time, index) => {
                const label = timeLabels[index] || `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${index + 1}`;
                timesHtml += `
                    <div class="suggested-time-item">
                        <div class="suggested-time">${time}</div>
                        <div class="suggested-label">${label}</div>
                        <div class="suggested-badge">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
                    </div>
                `;
            });
            
            timesHtml += `
                <div style="margin-top: 12px; font-size: 13px; color: #6B7280;">
                    üí° ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏≠‡∏™‡∏±‡πà‡∏á ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á"
                </div>
            `;
            
            suggestedTimesList.innerHTML = timesHtml;
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á
        function resetCustomTimes() {
            const reminderTimes = document.getElementById('reminder-times');
            
            // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (window.selectedMedicationData && window.selectedMedicationData.suggested_times) {
                const suggestedTimes = window.selectedMedicationData.suggested_times;
                const timeLabels = ['‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤', '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á', '‡∏°‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≤‡∏¢', '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô', '‡∏°‡∏∑‡πâ‡∏≠‡∏Ñ‡πà‡∏≥'];
                
                reminderTimes.innerHTML = '';
                
                suggestedTimes.forEach((time, index) => {
                    const timeItem = document.createElement('div');
                    timeItem.className = 'time-item';
                    timeItem.innerHTML = `
                        <input type="time" class="time-input" value="${time}" required>
                        <span class="time-label">${timeLabels[index] || `‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}`}</span>
                        <button type="button" class="time-remove" onclick="removeTimeInput(this)">√ó</button>
                    `;
                    reminderTimes.appendChild(timeItem);
                });
            } else {
                // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                reminderTimes.innerHTML = `
                    <div class="time-item">
                        <input type="time" class="time-input" value="08:00" required>
                        <span class="time-label">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</span>
                        <button type="button" class="time-remove" onclick="removeTimeInput(this)">√ó</button>
                    </div>
                `;
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function renderMedicationReminders() {
            const container = document.getElementById('reminders-container');
            
            if (!medicationReminders || medicationReminders.length === 0) {
                document.getElementById('reminders-empty').style.display = 'block';
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            container.innerHTML = '';
            
            medicationReminders.forEach(medicationGroup => {
                const reminderItem = document.createElement('div');
                reminderItem.className = 'medication-item';
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
                const timeTexts = medicationGroup.reminders.map(r => r.reminder_time).join(', ');
                
                reminderItem.innerHTML = `
                    <div class="medication-header">
                        <div>
                            <div class="medication-name">${medicationGroup.medication_name}</div>
                            <div class="medication-schedule">${medicationGroup.eye_display}</div>
                            <div class="medication-time">‡πÄ‡∏ß‡∏•‡∏≤: ${timeTexts}</div>
                            <div class="medication-time">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ${medicationGroup.frequency || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                        </div>
                        <div class="medication-actions">
                            <button class="medication-action-btn" onclick="showEditMedicationReminderModal('${medicationGroup.medication_id}')">
                                <span>‚úèÔ∏è</span> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(reminderItem);
            });
        }

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function showAddMedicationReminderModal() {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('addMedicationReminderForm').reset();
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
            document.getElementById('medication-info').style.display = 'none';
            document.getElementById('suggested-times-group').style.display = 'none';
            document.getElementById('custom-times-group').style.display = 'none';
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤
            const scheduleSelect = document.getElementById('medication-schedule');
            scheduleSelect.disabled = true;
            scheduleSelect.innerHTML = '<option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏Å‡πà‡∏≠‡∏ô</option>';
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
            const reminderTimes = document.getElementById('reminder-times');
            reminderTimes.innerHTML = `
                <div class="time-item">
                    <input type="time" class="time-input" required>
                    <span class="time-label">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</span>
                    <button type="button" class="time-remove" onclick="removeTimeInput(this)">√ó</button>
                </div>
            `;
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            window.selectedMedicationData = null;
            
            // ‡πÅ‡∏™‡∏î‡∏á Modal
            document.getElementById('addMedicationReminderModal').style.display = 'flex';
        }

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function showEditMedicationReminderModal(medicationId) {
            const medicationGroup = medicationReminders.find(m => m.medication_id === medicationId);
            
            if (!medicationGroup) return;
            
            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('edit-medication-name').value = medicationId;
            document.getElementById('edit-medication-note').value = '';
            
            // ‡πÅ‡∏™‡∏î‡∏á Modal
            document.getElementById('editMedicationReminderModal').style.display = 'flex';
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ (‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
        async function addMedicationReminder() {
            const token = checkAuth();
            if (!token) return;
            
            // ‡πÅ‡∏™‡∏î‡∏á Loading Spinner
            const saveButton = document.getElementById('saveMedicationReminderBtn');
            const spinner = document.getElementById('saveMedicationReminderSpinner');
            saveButton.disabled = true;
            spinner.style.display = 'inline-block';
            
            try {
                // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
                const medicationSelect = document.getElementById('medication-name');
                const schedule = document.getElementById('medication-schedule').value;
                const note = document.getElementById('medication-note').value;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
                if (!medicationSelect.value || !schedule) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤');
                    return;
                }
                
                const medicationData = JSON.parse(medicationSelect.value);
                let reminderTimes = [];
                
                // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                if (schedule === 'suggested') {
                    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                    reminderTimes = medicationData.suggested_times || ['08:00'];
                } else if (schedule === 'custom') {
                    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                    const timeInputs = document.querySelectorAll('#custom-times-group .time-input');
                    reminderTimes = Array.from(timeInputs).map(input => input.value).filter(time => time);
                }
                
                if (reminderTimes.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÄ‡∏ß‡∏•‡∏≤');
                    return;
                }
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÉ‡∏ä‡πâ endpoint ‡πÄ‡∏î‡∏¥‡∏°)
                let successCount = 0;
                for (const time of reminderTimes) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/patient/medication-reminders`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                prescription_id: medicationData.prescription_id,
                                medication_id: medicationData.medication_id,
                                reminder_time: time,
                                days_of_week: '0,1,2,3,4,5,6', // ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                                start_date: new Date().toISOString().split('T')[0],
                                end_date: null,
                                eye: medicationData.eye || 'both',
                                drops_count: 1,
                                notification_channels: 'app'
                            })
                        });
                        
                        if (response.ok) {
                            successCount++;
                        }
                    } catch (error) {
                        console.error('Error creating reminder for time:', time, error);
                    }
                }
                
                if (successCount > 0) {
                    // ‡∏õ‡∏¥‡∏î Modal
                    closeModal('addMedicationReminderModal');
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    loadMedicationReminders();
                    loadMedications();
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    alert(`‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤ "${medicationData.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${successCount} ‡πÄ‡∏ß‡∏•‡∏≤)`);
                } else {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ');
                }
                
            } catch (error) {
                console.error('Error adding medication reminder:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            } finally {
                // ‡∏ã‡πà‡∏≠‡∏ô Loading Spinner
                saveButton.disabled = false;
                spinner.style.display = 'none';
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        async function updateMedicationReminder() {
            alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        }

        // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        async function deleteMedicationReminder() {
            alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        async function loadNotificationSettings() {
            const token = checkAuth();
            if (!token) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/patient/settings`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load notification settings');
                }
                
                const data = await response.json();
                const settings = data.settings;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                if (settings && settings.notification_preferences) {
                    try {
                        const notificationSettings = JSON.parse(settings.notification_preferences);
                        
                        // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
                        if (notificationSettings.medication) {
                            document.getElementById('medication-notifications').checked = notificationSettings.medication.enabled !== false;
                            
                            if (notificationSettings.medication.reminder_time !== undefined) {
                                document.getElementById('medication-reminder-time').value = notificationSettings.medication.reminder_time;
                            }
                            
                            if (notificationSettings.medication.repeat_interval !== undefined) {
                                document.getElementById('medication-reminder-repeat').value = notificationSettings.medication.repeat_interval;
                            }
                            
                            if (notificationSettings.medication.max_repeats !== undefined) {
                                document.getElementById('medication-reminder-max-repeat').value = notificationSettings.medication.max_repeats;
                            }
                            
                            if (notificationSettings.medication.sound) {
                                document.getElementById('medication-reminder-sound').value = notificationSettings.medication.sound;
                            }
                        }
                        
                        // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
                        if (notificationSettings.appointment) {
                            document.getElementById('appointment-notifications').checked = notificationSettings.appointment.enabled !== false;
                            
                            if (notificationSettings.appointment.days_before !== undefined) {
                                document.getElementById('appointment-reminder-time').value = notificationSettings.appointment.days_before;
                            }
                            
                            if (notificationSettings.appointment.reminder_hour) {
                                document.getElementById('appointment-reminder-hour').value = notificationSettings.appointment.reminder_hour;
                            }
                            
                            if (notificationSettings.appointment.remind_on_day !== undefined) {
                                document.getElementById('appointment-reminder-day-of').checked = notificationSettings.appointment.remind_on_day;
                            }
                            
                            if (notificationSettings.appointment.sound) {
                                document.getElementById('appointment-reminder-sound').value = notificationSettings.appointment.sound;
                            }
                        }
                        
                        // ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                        if (notificationSettings.iop_alerts !== undefined) {
                            document.getElementById('iop-notifications').checked = notificationSettings.iop_alerts;
                        }
                        
                        if (notificationSettings.medication_inventory_alerts !== undefined) {
                            document.getElementById('medication-inventory-notifications').checked = notificationSettings.medication_inventory_alerts;
                        }
                        
                        if (notificationSettings.test_result_alerts !== undefined) {
                            document.getElementById('result-notifications').checked = notificationSettings.test_result_alerts;
                        }
                    } catch (parseError) {
                        console.error('Error parsing notification settings:', parseError);
                    }
                }
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                updateSettingsVisibility();
                
            } catch (error) {
                console.error('Error loading notification settings:', error);
                showApiError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ');
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        async function saveNotificationSettings() {
            const token = checkAuth();
            if (!token) return;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            const notificationSettings = {
                medication: {
                    enabled: document.getElementById('medication-notifications').checked,
                    reminder_time: parseInt(document.getElementById('medication-reminder-time').value),
                    repeat_interval: parseInt(document.getElementById('medication-reminder-repeat').value),
                    max_repeats: parseInt(document.getElementById('medication-reminder-max-repeat').value),
                    sound: document.getElementById('medication-reminder-sound').value
                },
                appointment: {
                    enabled: document.getElementById('appointment-notifications').checked,
                    days_before: parseInt(document.getElementById('appointment-reminder-time').value),
                    reminder_hour: document.getElementById('appointment-reminder-hour').value,
                    remind_on_day: document.getElementById('appointment-reminder-day-of').checked,
                    sound: document.getElementById('appointment-reminder-sound').value
                },
                iop_alerts: document.getElementById('iop-notifications').checked,
                medication_inventory_alerts: document.getElementById('medication-inventory-notifications').checked,
                test_result_alerts: document.getElementById('result-notifications').checked
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/patient/settings`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        notification_preferences: JSON.stringify(notificationSettings)
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save notification settings');
                }
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Error saving notification settings:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        function updateSettingsVisibility() {
            // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
            const medicationSettings = document.getElementById('medication-settings');
            if (document.getElementById('medication-notifications').checked) {
                medicationSettings.style.display = 'block';
            } else {
                medicationSettings.style.display = 'none';
            }
            
            // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
            const appointmentSettings = document.getElementById('appointment-settings');
            if (document.getElementById('appointment-notifications').checked) {
                appointmentSettings.style.display = 'block';
            } else {
                appointmentSettings.style.display = 'none';
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function addTimeInput() {
            const reminderTimes = document.getElementById('reminder-times');
            const timeItems = reminderTimes.querySelectorAll('.time-item');
            
            const timeItem = document.createElement('div');
            timeItem.className = 'time-item';
            
            let timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤';
            if (timeItems.length === 1) timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';
            else if (timeItems.length === 2) timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô';
            else if (timeItems.length > 2) timeLabel = `‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà ${timeItems.length + 1}`;
            
            timeItem.innerHTML = `
                <input type="time" class="time-input" required>
                <span class="time-label">${timeLabel}</span>
                <button type="button" class="time-remove" onclick="removeTimeInput(this)">√ó</button>
            `;
            
            reminderTimes.appendChild(timeItem);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
        function addEditTimeInput() {
            const reminderTimes = document.getElementById('edit-reminder-times');
            const timeItems = reminderTimes.querySelectorAll('.time-item');
            
            const timeItem = document.createElement('div');
            timeItem.className = 'time-item';
            
            let timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤';
            if (timeItems.length === 1) timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';
            else if (timeItems.length === 2) timeLabel = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô';
            else if (timeItems.length > 2) timeLabel = `‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà ${timeItems.length + 1}`;
            
            timeItem.innerHTML = `
                <input type="time" class="time-input" required>
                <span class="time-label">${timeLabel}</span>
                <button type="button" class="time-remove" onclick="removeEditTimeInput(this)">√ó</button>
            `;
            
            reminderTimes.appendChild(timeItem);
        }

        // ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤
        function removeTimeInput(button) {
            const timeItems = document.querySelectorAll('#reminder-times .time-item');
            
            if (timeItems.length > 1) {
                const timeItem = button.closest('.time-item');
                timeItem.remove();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                const updatedTimeItems = document.querySelectorAll('#reminder-times .time-item');
                updatedTimeItems.forEach((item, index) => {
                    const label = item.querySelector('.time-label');
                    
                    if (index === 0) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤';
                    else if (index === 1) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';
                    else if (index === 2) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô';
                    else label.textContent = `‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}`;
                });
            } else {
                alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÄ‡∏ß‡∏•‡∏≤');
            }
        }

        // ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
        function removeEditTimeInput(button) {
            const timeItems = document.querySelectorAll('#edit-reminder-times .time-item');
            
            if (timeItems.length > 1) {
                const timeItem = button.closest('.time-item');
                timeItem.remove();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                const updatedTimeItems = document.querySelectorAll('#edit-reminder-times .time-item');
                updatedTimeItems.forEach((item, index) => {
                    const label = item.querySelector('.time-label');
                    
                    if (index === 0) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤';
                    else if (index === 1) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';
                    else if (index === 2) label.textContent = '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô';
                    else label.textContent = `‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}`;
                });
            } else {
                alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÄ‡∏ß‡∏•‡∏≤');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î API
        function showApiError(message) {
            const apiError = document.getElementById('apiError');
            const apiErrorMessage = document.getElementById('apiErrorMessage');
            
            apiErrorMessage.textContent = message;
            apiError.style.display = 'flex';
        }

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î API
        function hideApiError() {
            document.getElementById('apiError').style.display = 'none';
        }

        // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏°‡∏ô‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('show');
        }

        // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Sidebar (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // ‡∏õ‡∏¥‡∏î Modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.round(diffMs / 1000);
            const diffMin = Math.round(diffSec / 60);
            const diffHour = Math.round(diffMin / 60);
            const diffDay = Math.round(diffHour / 24);
            
            if (diffSec < 60) {
                return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
            } else if (diffMin < 60) {
                return `${diffMin} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            } else if (diffHour < 24) {
                return `${diffHour} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            } else if (diffDay < 7) {
                return `${diffDay} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            } else {
                // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏Å‡∏ï‡∏¥
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
        }

        // Logout function
        function logout() {
            const token = checkAuth();
            if (!token) return;
            
            fetch(`${API_BASE_URL}/auth/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(() => {
                localStorage.removeItem('gtms_token');
                localStorage.removeItem('gtms_user');
                window.location.href = 'index.html';
            })
            .catch(error => {
                console.error('Logout error:', error);
                // Force logout even if API fails
                localStorage.removeItem('gtms_token');
                localStorage.removeItem('gtms_user');
                window.location.href = 'index.html';
            });
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            if (!checkAuth()) {
                return;
            }
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            loadUserProfile();
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            document.getElementById('medication-notifications').addEventListener('change', updateSettingsVisibility);
            document.getElementById('appointment-notifications').addEventListener('change', updateSettingsVisibility);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å dropdown ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const userDropdown = document.querySelector('.user-dropdown');
                
                if (userMenu && userMenu.classList.contains('show') && userDropdown && !userDropdown.contains(event.target)) {
                    userMenu.classList.remove('show');
                }
                
                // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å modal
                document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                    if (backdrop.style.display === 'flex' && !backdrop.querySelector('.modal').contains(event.target)) {
                        backdrop.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>